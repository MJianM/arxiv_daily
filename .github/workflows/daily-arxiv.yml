name: Daily arXiv Update

on:
  # 支持手动触发
  workflow_dispatch:
  # 每天定时运行（UTC 时间 02:00，可按需修改）
  schedule:
    - cron: "0 2 * * *"

permissions:
  contents: write

jobs:
  update-arxiv:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Configure git user
        run: |
          git config user.name "MJianM"
          git config user.email "nymjm11@sjtu.edu.cn"

      - name: Run daily_arxiv script
        env:
          # 如需使用 GitHub Secrets，请在仓库 Settings -> Secrets 中创建 GEMINI_API_KEY
          # 然后将 config.yaml 中的 gemini_api_key 改为该环境变量，或在脚本中读取 env。
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          python daily_arxiv.py --config_path config.yaml

